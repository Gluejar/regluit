{% extends "basedocumentation.html" %}
{% load humanize %}

{% block title %}Campaign Management{% endblock %}

{% block extra_extra_head %}
<style type="text/css">
textarea {
	width: 90%;
}
</style>
<link type="text/css" rel="stylesheet" href="/static/css/manage_campaign.css" />

<script type="text/javascript" src="/static/js/tabs.js"></script>

<script type="text/javascript">
var $j = jQuery.noConflict();
$j(document).ready(function(){
	$j('span.rh_help').click(
		function() {
			var questionID = $j(this).attr('id');
			var answerID = "#"+questionID+"2";
			$j(answerID).toggle(300);
		}
	);
});
</script>

<script>
var $j = jQuery.noConflict();
$j(document).ready(function(){
	$j('#launchme').click(function() {
		$j('#campaign_launcher').click();
	});
});
</script>
{% endblock %}

{% block topsection %}
{% endblock %}

{% block doccontent %}
{% with campaign.status as campaign_status %}
{% if campaign.not_manager %}
<h2>You're not a manager for campaign: {{ campaign.name }}</h2>
{% else %}
<div id="locationhash">{{ activetab }}</div>
{% for alert in alerts %}
<h1 class="alert">{{ alert }}</h1>
{% empty %}
<h1>Manage the campaign</h1>
{% endfor %}
{% for problem in problems %}
Please fix the following before launching your campaign:
<br /><br />
<ul class="errorlist">
<li>{{ problem }}</li>
</ul>
{% empty %}
<!--{{form.errors}}-->
{% endfor %}

(Or, <a href="{% url rightsholders %}">go back</a> to rights holder tools page.)<br />
<div style="height:15px;"></div>
<div class="book-detail">
	<div id="book-detail-img">
		<a href="#"><img src="{{ work.cover_image_thumbnail }}" alt="{{ work.title }}" title="{{ work.title }}" width="131" height="192" /></a>
    </div>
    
    <div class="book-detail-info">
		<div class="layout">
			<h2 class="book-name">{{ work.title }}</h2>
			<div>
				<div class="pubinfo">
					<h3 class="book-author">{{ work.author }}</h3>
					<h3 class="book-year">{{ work.publication_date_year }}</h3>
				</div>
			</div>
		</div>
                
        <div class="pledged-info">
        	<div class="pledged-group">
        	{% ifequal work.last_campaign.type 1 %}
        		{{ work.last_campaign.supporters_count }} Ungluers have pledged ${{ work.last_campaign.current_total|intcomma }}
        	{% else %}
        		Total revenue: ${{ work.last_campaign.current_total|intcomma }} from {{ work.last_campaign.supporters_count }} Ungluers 
        	{% endifequal %}
        	</div>
        	<div class="status">
        		<img src="/static/images/images/icon-book-37by25-{{ work.percent_unglued }}.png"  title="{{ work.percent_of_goal }}% of goal" alt="book list status" />
        	</div>
        </div>
    </div>

	<div class="preview_campaign">
	{% ifequal campaign_status 'INITIALIZED' %}
		<a href="{% url work_preview campaign.work.id %}" class="manage" target="_blank">Preview Your Campaign</a>
	{% else %}
		<a href="{% url work campaign.work.id %}" class="manage" target="_blank">See Your Campaign</a>
	{% endifequal %}
	</div>

</div>

<div class="content-block-heading" id="tabs">
	<ul class="tabs">
		<li class="tabs1 {% if activetab == '1' %}active{% endif %}"><a href="#">Description</a></li>
		<li class="tabs2 {% if activetab == '2' %}active{% endif %}"><a href="#">{% ifequal campaign.type 2 %}Pricing{% else %}Premiums{% endifequal %}</a></li>
		<li class="tabs3 {% if activetab == '3' %}active{% endif %}"><a href="#">{% if campaign_status == 'ACTIVE' or campaign_status == 'SUCCESSFUL'  %}Progress{% else %}Launch{% endif %}</a></li>
	</ul>
</div>
<div class="clearfix"></div>

<div class="tabs-1">
    <h3>Edit the editions (if needed)</h3>
{% if campaign.rh.can_sell %}
	<p> If you want to sell ebooks as part of a buy to unglue campaign, you'll need to upload the ebook files that you want to sell. </p>
{% endif %}
    <ul>
    {% for edition in campaign.work.editions.all %}
    <li> <a href="{% url new_edition edition.work.id edition.id %}"> Edit </a><i>{{ edition }}</i>
        {% if campaign.rh.can_sell %}You can also <a href="{% url edition_uploads edition.id %}"> load files</a> for this edition.
        <ul>
        {% for ebook_file in edition.ebook_files.all %}
        <li>{{ebook_file.file}} created {{ebook_file.created}} </li>
        {% endfor %}
        </ul>
        {% endif %}
    </li>
    {% endfor %}
    </ul>
<form action="#" method="POST">
	{% csrf_token %}
	{{ form.media }}
	<h3>Select the main edition</h3>
	<p> Please choose the edition that most closely matches the edition to be unglued.  This is the edition whose cover image will display on your book's page.  Your unglued edition should be identical to this edition if possible; you should note any differences under Rights Details below.</p>

	
	{{ form.edition.errors }}{{ form.edition }}
	{% if campaign.edition %}
	<p>If the details of the edition you've chosen aren't accurate, you can <a href="{% url rh_edition work.id campaign.edition.id %}">edit the edition</a>.</p>
	{% else %}
	<p>If the edition details are inaccurate (e.g. wrong cover image), go ahead and set up the campaign with that edition anyway.  You'll be able to edit the edition details from this page later on.</p>
	{% endif %}
	<p>If you don't see an edition that matches what you want to release, you can <a href="{% url rh_edition work.id '' %}">create a new edition</a>.</p>
{% ifnotequal campaign_status 'ACTIVE' %}
	<h3>License being offered</h3>
	<p> This is the license you are offering to use once the campaign succeeds. For more information on the licenses you can use, see <a href="http://creativecommons.org/licenses">Creative Commons: About the Licenses</a>.  Once your campaign is active, you'll be able to switch to a less restrictive license, but not a more restrictive one.  We encourage you to pick the least restrictive license you are comfortable with, as this will increase the ways people can use your unglued ebook and motivate more people to donate.</p>
	{{ form.license.errors }}{{ form.license }}
	
	{% ifequal campaign.type 1 %}
        <h3>Target Price</h3>
        <p>This is the target price for your campaign. The <i>minimum</i> target is ${{form.minimum_target|intcomma}}.</p>
    
        <p>Your target should be high enough to compensate you for potential lost future revenue from sales of this edition and reflect well on your brand, but low enough to seem realistic to supporters; people are more likely to back campaigns that they think will succeed.</p>
    
        <p>Once you launch the campaign, you'll be able to decrease your target, but not increase it.</p>
    
        <p>Please email us if you want to talk about pricing strategy.</p>
    
        {{ form.target.errors }}${{ form.target }}
    
        <h3>Ending date</h3>
        <p> This is the ending date of your campaign. Once you launch the campaign, you won't be able to change it.</p>
    
        <p>The ending date can't be more than six months away- that's a practical limit for credit card authorizations. The <i>latest</i> ending you can choose <i>right now</i> is {{ campaign.latest_ending }}</p>
        {{ form.deadline.errors }}{{ form.deadline }}
    {% else %}
        <h3>Revenue Target</h3>
        <p>This is the revenue target for your campaign. If you hit this target, your book gets released immediately, for free, under the Creative Commons License that you've specified. With time the actual revenue needed to trigger Creative Commons will gradually decrease.</p>
        
        <p>The <i>minimum</i> revenue target is ${{form.minimum_target|intcomma}}.The <i>maximum</i> revenue target is ${{form.maximum_target|intcomma}}. Yep. </p>
    
        <p>Your target should be high enough to compensate you for potential lost future revenue from sales of this edition and reflect well on your brand, but low enough to seem realistic to supporters; people are more likely to back campaigns that they think will succeed.</p>
    
        <p>Once you launch the campaign, you'll be able to decrease your target, but not increase it.</p>
    
        <p>Please email us if you want to talk about pricing strategy.</p>
    
        {{ form.target.errors }}${{ form.target }}
    
        <h3>Initial CC Date</h3>
        <p>When you launch a Buy-To-Unglue campaign, you will specify a date in the future at which your book will become Creative Commons Licensed. eBooks sold via unglue.it will include a notice of this license. With every sale, the effective date of this license will advance a bit toward the present.  </p>

	    <p>Before launching a campaign, you'll need to select Your initial CC Date. Together with your campaign revenue target, this will define when your book becomes "unglued". Your starting CC Date must be before {{ form.max_cc_date }}</p>
        {{ form.cc_date_initial.errors }}{{ form.cc_date_initial }}
	    <!--{{ form.deadline.errors }}-->{{ form.deadline }}
	{% endifequal %}
	
{% else %}
	<h3>License being offered</h3>
	<p>If your campaign succeeds, you will be offering your ebook under a <b><a href="{{campaign.license_url }}">{{ campaign.license }}</a></b> license.</p>
	<p>Since your campaign is active, you may only change the license to remove restrictions. For more information on the licenses you can use, see <a href="http://creativecommons.org/licenses">Creative Commons: About the Licenses</a>.</p></p>
	{{ form.license.errors }}<span>{{ form.license }}</span>
	<h3>Target Price</h3>
	<p>The current target price for your campaign is <b>${{ campaign.target|intcomma }}</b>. Since your campaign is active, you may lower, but not raise, this target.</p>
	${{ form.target.errors }}{{ form.target }}

	{% ifequal campaign.type 1 %}
        <h3>Ending date</h3>
        <p>The ending date of your campaign is <b>{{ campaign.deadline }}</b>.  Your campaign will conclude on this date or when you meet your target price, whichever is earlier.  You may not change the ending date of an active campaign.</p>
        {{ form.deadline.errors }}<span style="display: none">{{ form.deadline }}</span>
	{% else %}
	    <h3>CC Date</h3>
	    <p> This campaign was launched with a CC Date of {{ campaign.cc_date_initial }}.</p>
	    <p> Based on a total revenue of {{ campaign.current_total }} the CC Date has been advanced to {{ campaign.cc_date }}.</p>
        {{ form.cc_date_initial.errors }}{{ form.cc_date_initial }}
        <h3>Ending date</h3>
        <p>Your sales campaign will run until <b>{{ campaign.deadline }}</b>. Contact unglue.it staff to extend it.</p>
        <!--{{ form.deadline.errors }}-->{{ form.deadline }}
	{% endifequal %}
{% endifnotequal %}


	<h3>Make Your Pitch</h3>
	<p>This will be displayed in the Campaign tab for your work.  It's your main pitch to supporters.</p>
	
	<p>This isn't a dry synopsis in a catalog.  It's your chance to be creative, to share your passion for this work, and to inspire readers.  A strong pitch:</p>
	
	<ul class="terms">
	<li>Introduces the work.  What's this book like?</li>
	<li>Shows why it matters.  How will someone or something -- the world, readers, some cause that matters -- be better off if this book becomes freely available?  What kind of impact has the book had already?  What will ungluers get out of supporting this campaign?</li>
	<li>Has visual appeal (photos and/or videos).</li>
	<li>Defines important but potentially unfamiliar things.  What's an ungluing campaign, and why are you running one?  Is there anything unusual about the book, its genre, et cetera?  For those who aren't already familiar with you (or the author), who are you?  {% ifequal campaign.type 1 %}Are you offering any particularly great premiums you want to call people's attention to?{% endifequal %}</li>
	<li>Gives examples of the author's work.  This could be links to your site or places people can find more information about you or the book.  You can also add quotes, embed a free sample chapter or story, display images, et cetera.  These work samples might be from the campaign book itself, or from your (or the author's) other creative works.</li>
	<li>Has personality.  The writing should be thoroughly proofread but it should have a point of view.  This is the place to be conversational, opinionated, funny, quirky -- whatever reflects your style.  Be you.</li>
	<li>Optionally, provides extra incentives (like new or improved premiums) that will kick in if the campaign is unusually successful.  Will you do something special when you reach 10% or 50% or 75% of your goal?  Or if you reach that milestone before a particular deadline (e.g. in the first week of your campaign)?</li>
	</ul>
	
	<h4>How to add video</h4>
	<p>We strongly encourage you to include video that communicates directly with your supporters.  To add a video:</p>
	<ul class="bullets">
	<li>Upload it to YouTube.</li>
	<li>Underneath the video, click Share, then Embed.</li>
	<li>In the embed options: click Use HTTPS.</li>
	<li>In the Custom sizing area, enter a width of 445.</li>
	<li>In the editor toolbar below, click Source.</li>
	<li>Copy/paste the embed code from YouTube into your campaign below.</li>
	<li>Click Source again to get back to the normal editing mode.</li>
	</ul>
	<p>You'll see an IFRAME code in the editor where your video will go.  The video will display normally on your campaign page.</p>
	
	<p>
		Prefer screencasts? Here you go: <a href="/static/images/How_to_embed_a_video.mp4">how to embed a video</a> in your campaign page.
	</p>
	
	<h4>How to add a PDF</h4>
	This assumes that you have a (free) Google account.
	
	<ul class="bullets">
		<li>Upload your PDF to <a href="http://drive.google.com">Google Drive</a>.</li>
		<li>Click on the Share button.</li>
		<li>Change the visibility to public on the web and click Save, then Done.</li>
		<li>In the File menu, click the Embed this PDF option.</li>
		<li>Copy the HTML code that pops up.</li>
		<li>In the editor toolbar below, click Source.</li>
		<li>Paste the HTML code from Google Drive in the box below.</li>
		<li>Find the part of the code that says something like <pre>width="640"</pre> and change that to <pre>width="445"</pre>.</li>
	<li>Click Source again to get back to the normal editing mode.</li>
	</ul>
	<p>You'll see an IFRAME code in the editor where your PDF will go.  The PDF will display normally on your campaign page.</p>

	<p>
    Prefer screencasts?  Here: <a href="/static/images/How_to_embed_a_PDF.mp4">how to embed a PDF</a> in your campaign page (screencast)
	</p>

	{{ form.description.errors }}{{ form.description }}
	<h3>Edition and Rights Details</h3>
	<p>This will be displayed on the More... tab for your work.  It's the fine print for your campaign.  Make sure to disclose any ways the unglued edition will differ from the existing edition; for example:
	<ul>
	<li>Any material that may have to be excluded due to permissions issues: illustrations, forewords, etc.</li>
	<li>Any additional materials that will be included, if not already covered in your pitch -- but we encourage you to cover them there to show supporters the value of ungluing!</li>
	<li>If the cover image will differ.</li>
	</ul>
	
	<p>In short, is there a fact about this campaign that you think would matter to your agent or another publishing wonk, but that no one else is likely to care about?  Put it here.  If your campaign doesn't have any fine print, you can leave this blank.</p>
	{{ form.details.errors }}{{ form.details }}

	
	<h3>e-mail contact addresses</h3>
	<p>Enter the email address where notifications about this campaign should be sent. If your campaign succeeds, this email needs to work if you want to get paid! This address will not be exposed on the website.</p>
	<p>{{ form.paypal_receiver.errors }}{{ form.paypal_receiver }}</p>
	<p>(Optional, but highly recommended). Enter an email address where ungluers with questions about the book or the campaign can contact you or someone involved. This address will not be exposed on the website.</p>
	<p>{{ form.email.errors }}{{ form.email }}</p>
    
    {% if work.publishers %}
	<h3>Publisher</h3>
	<p>If you are set up as an unglue.it publisher (send us a url, logo, description and list of ways your name might appear) you can link your campaign by selecting the publisher here:
	<p>{{ form.publisher.errors }}{{ form.publisher }}</p>	
	{% endif %}
	{% ifequal campaign_status 'ACTIVE' %}
		<div class="yikes">When you click this button, your changes will be visible to supporters immediately. Make sure to proofread!</div><br />
		<input type="submit" name="save" value="Modify Campaign" />
	{% else %}
		<br /><br /><input type="submit" name="save" value="Save Campaign" />
	{% endifequal %}
	
	{% if not is_preview or request.user.is_staff %}
		{% if campaign_status == 'INITIALIZED' %}
		<input id="campaign_launcher" type="submit" name="launch" value="Launch Campaign" />
		{% endif %}
	{% endif %}
	</form>
</div>

<div class="tabs-2">
{% ifequal campaign.type 1 %}
	<h3>Premiums</h3>
	<div class="jsmod-content">
		<form action="#" method="POST">
		{% csrf_token %}
		<ul class="support menu">
			{% for premium in premiums %}
			<li class="{% if forloop.first %}first{% else %}{% if forloop.last %}last{% endif %}{% endif %}">
			<i>
				<span class="menu-item-price">${{ premium.amount|intcomma }}</span>
				<span class="menu-item-desc">{{ premium.description }}</span>
			</i>
			{% ifnotequal premium.limit 0 %}<br />Limit:  {{ premium.limit }}{% endifnotequal %}
			{% ifequal premium.type 'CU' %}<br />Deactivate?  <input type="checkbox" name="premium_id" value="{{ premium.id }}" />{% endifequal %}
			</li>
			{% endfor %}
		 </ul>
		 {% if campaign.custom_premiums.count %}
		 <input type="submit" name="inactivate" value="Deactivate Checked Premiums" />
		 {% endif %}
		</form>
	</div>
	<h4>Add a premium for this campaign</h4>

	<form action="#" method="POST" id="premium_add">
	{% csrf_token %}
	<span class="premium_add_label">Pledge Amount ($2000 maximum):</span> {{ premium_form.amount.errors }}<span class="premium_field_label">$</span>{{ premium_form.amount }}<br /><br />
	<span class="premium_add_label">Premium Description:</span> {{ premium_form.description.errors }}{{ premium_form.description }}<br /><br />
	<span class="premium_add_label">Number Available (0 if no limit):</span> {{ premium_form.limit.errors }}{{ premium_form.limit }}<br /><br />
	{{ premium_form.campaign }}
	{{ premium_form.type.errors }}{{ premium_form.type }}
	<br />
	<input type="submit" name="add_premium" value="Add Premium" />
	</form><br /><br />

	<h4>Editing premiums</h4>
	<p>At this time, you can't edit a premium you've created. But you can deactivate a premium and add a new one to replace it. So be sure to double-check your spelling before adding it.</p>
	
	<p>If you deactivate a premium that people have pledged toward, you are <b>still responsible for delivering it</b> to those pledgers.</p>
	
	<p>A few things to keep in mind:</p>
	<ul>
	<li>Are your premiums cumulative?  That is, if you have a $10 and a $25 premium, does the $25 pledger get everything that the $10 pledger gets also?  Either cumulative or not-cumulative is fine, but make sure you've communicated clearly</li>
	<li>Adding new premiums during your campaign is a great way to build momentum.  If you do, make sure to leave a comment in the Comments tab of your campaign page to tell supporters (it will be automatically emailed to them).  Some of them may want to change (hopefully increase) their pledge to take advantage of it.</li>
	<li>Also make sure to think about how your new premiums interact with old ones.  If you add a new premium at $10, will people who have already pledged $25 be automatically eligible for it or not?  Again, you can choose whatever you want; just be sure to communicate clearly.</li>
	</ul>
	
	<h4>Acknowledgements</h4>
	<p>Your ungluers will also automatically receive the following acknowledgements:</p>
	<ul class="terms">
		<li><em>Any amount</em> &#8212; The unglued ebook</li>
		<li><em>$25 and above</em> &#8212; Their name in the acknowledgements section under "supporters"</li>
		<li><em>$50 and above</em> &#8212; Their name &amp; profile link under "benefactors"</li>
		<li><em>$100 and above</em> &#8212; Their name, profile link, &amp; a dedication under "bibliophiles"</li>
	</ul>
	<p>Your premium values may be any amounts -- you do not need to offer premiums at $25/$50/$100.  For example, if you offer a $30 premium, anyone pledging to it will be eligible for the $25 reward.  This will be communicated to them during the pledging process; you do not need to explain it in your pitch.</p>
{% endifequal %}
{% ifequal campaign.type 2 %}
<h3> Offers to sell </h3>
<p> Make sure that ebook files for this work <a class="tabs1">have been loaded</a>!
<div class="jsmod-content">
<p>
{% for offer in offers %}
<form action="#" method="POST">
{% csrf_token %}
{{ offer.offer_form.as_p }}
<br />
<input type="submit" name="change_offer" value="Change Offer" />
</form>

{% endfor %}
</div>
{% endifequal %}
</div>

{% ifequal campaign_status 'INITIALIZED' %}
<div class="tabs-3">
	{% if not is_preview or request.user.is_staff %}
		{% if campaign.description and campaign.target and campaign.deadline and campaign.launchable %}
		<p>Before you hit launch:</p>
		<ul>
			<li>Have you proofread your campaign? (Make sure to spellcheck!)</li>
			<li>Have you <a href="{% url work_preview campaign.work.id %}">previewed your campaign</a>? Does it look how you want it to?</li>
		</ul>
			
		<p>If it doesn't look exactly the way you like, or you're having any trouble with your description or premiums, we're happy to help; please email unglue.it support (<a href="mailto:support@gluejar.com">support@gluejar.com</a>).</p>
		
		<p>If you're happy with your campaign, here's your moment of truth!</p>
		
		<div id="launchme"><a href="#" class="manage">Launch Campaign</a></div>
		{% else %}
            <p>Please make sure you've selected your campaign's edition and entered its description, target, deadline, and premiums, and previewed your campaign, before launching.</p>
            {% ifequal campaign.type 2 %}
            <p> Buy To Unglue campaigns can't be launched until ebook files <a class="tabs1">have been loaded</a> and <a  class="tabs2">pricing has been set and made active</a></p>
            <!-- {{campaign.problems }} -->
            {% endifequal %}
            
		{% endif %}
	{% else %}
		While you're free to edit your campaign, it won't be launchable until we've fully tested our new payment processor.
	{% endif %}
	
</div>
{% endifequal %}

<div class="tabs-3">
{% if campaign_status == 'ACTIVE' or campaign_status == 'SUCCESSFUL'  %}
{% if campaign_status == 'ACTIVE' %}
<h2 class="thank-you">Your campaign is now active! Hooray!</h2>

<h3>What to do next</h3>
<ul>
<li>Tell your friends, relatives, media contacts, professional organizations, social media networks -- everyone!</li>
<li>Check in with your campaign frequently.  Use comments, description updates, and maybe new premiums to spark additional interest, keep supporters engaged, and keep the momentum going.</li>
<li>Watch media and social networks for mentions of your campaign, and engage in those conversations.</li>
<li>Need help doing any of this?  Talk to us.</li>
</ul>
{% endif %}
<h3>Acknowledgements</h3>
<p>When you're logged in, the "Ungluers" tab on the <a href="{% url work work.id %}">campaign page</a> will tell you a bit about each ungluer- when they last pledged, for example, and you can send individual messages to each ungluer. Use this tool with care! You can see who your biggest supporters are by looking at the <a href="{% url work_acks campaign.work.id %}">sample acknowledgement page</a>. 
After your campaign succeeds, you can used this page to generate epub code for the acknowledgements section of your unglued ebook.
</p>
{% endif %}
</div>

{% endif %}
{% endwith %}
{% endblock %}