{% extends "base.html" %}
{% load humanize %}
{% with work.title as title %}
{% block title %}
&mdash; Downloads for {{ work.title }}
{% endblock %}

{% block extra_js %}
<script type="text/javascript" src="/static/js/readmill.js"></script>
<script type="text/javascript" src="/static/js/embed.js"></script>
<script type="text/javascript" src="/static/js/download_page.js"></script>
<script type="text/javascript">
var $j = jQuery.noConflict();
$j(document).ready(function() {
    // actually trigger the download_page function
    $j(document).trigger('prettifyDownload');
});
</script>
{% endblock %}

{% block content %}
<div class="download_container">
<div id="lightbox_content">

{% if show_beg %}
<div class="border" style="padding: 10px;">
    <div id="begblock" class="rh_beg">
        <div>Please help us thank the creators for making this book free. The amount is up to you.</div>
        <form class="begform" method="POST" action="{% url thank work.id %}#">
            {% csrf_token %}
            {{ form.non_field_errors }}
                <div class="contrib_amount">Amount: {{ form.preapproval_amount.errors }}${{ form.preapproval_amount }}</div>
                <div style="text-align: center;"><input name="pledge" type="submit" value="Say Thank You" id="contribsubmit" class="loader-gif" /></div>
                <div id="anoncontribbox"><I>{{ form.anonymous.label_tag }}</I> {{ form.anonymous.errors }}{{ form.anonymous }}</div>
            {% if request.user.credit.available > 0 %}
                <div > You have an available  credit of ${{ request.user.credit.available|intcomma }} which will be applied to your contribution.</div>
            {% endif %}
        </form> 
    </div>
    
    <div class="rh_beg" style="">
            {{ work.last_campaign.description|safe }}
    </div>
</div>
{% endif %}
{% if user_license.thanked %}
    <div style="text-align: center; padding: 20px;">
    <div style="background: #edf3f4; padding: 10px; width:35%; display: inline; ">
    You have supported this free book!
    </div>
    </div>
{% endif %}
{% if amount %}
    <div style="text-align: center; padding: 20px;">
    <div style="background: #edf3f4; padding: 10px; width:35%; display: inline; ">
    Your contribution of ${{amount}} is confirmed.
    {% if request.session.receipt %}
    A confirmation is being sent to {{ request.session.receipt }}.
    {% endif %}
    </div>
    </div>
{% endif %}
<div class="border">
    <h2 style="width:60%">Downloads for <I><a href="{% url work work.id %}">{{ work.title }}</a></i></h2>
    <div class="sharing ebook_download_container">
        <h3 class="jsmod-title"><span>Share</span></h3>
        <ul class="social menu">
            {% with site.domain as domain %}
            <a href="https://www.facebook.com/sharer.php?u=https://{{ site.domain }}{% url work work.id|urlencode:"" %}"><li class="facebook first"><span>Facebook</span></li></a>
            <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri|urlencode:"" }}&amp;text=I%27m%20enjoying%20{{ work.title|urlencode }}%2C%20a%20free%2C%20non%2DDRM%20ebook%2E%20You%20can%20too%21"><li class="twitter"><span>Twitter</span></li></a>
            {% endwith %}
            {% if request.user.is_authenticated %}<a href="{% url emailshare 'downloaded' %}?next={% url work work.id %}"><li class="email"><span>Email</span></li></a>{% endif %}
            <a id="embed2"><li class="embed"><span>Embed</span></li></a>
            <div id="widgetcode2">Copy/paste this into your site:<br /><textarea rows="7" cols="22">&lt;iframe src="https://{{ request.META.HTTP_HOST }}/api/widget/{{ work.first_isbn_13 }}/" width="152" height="325" frameborder="0"&gt;&lt;/iframe&gt;</textarea></div>
        </ul>
    </div>
    {% if readmill_epub_url or can_kindle %}
        <div class="one_click clearfix">
            <h3>One-click options</h3>
            {% if can_kindle %}
                <div id="kindle_div">
                    {% if request.user.is_authenticated and request.user.profile.kindle_email %}
                        <div class="yes_js">
                            <div id="kindle" class="btn_support authenticated" title="{{ work.id }}" >
                                <a>Send to Kindle</a>
                            </div>
                        </div>
                        <div class="no_js">
                            <form method="POST" class="btn_support" action="{% url send_to_kindle work.id 0 %}">
                                <input type="submit" value="Send to Kindle">
                            </form>
                        </div>
                    {% else %}
                        <div class="btn_support kindle">
                            <a href="{% url kindle_config_download work.id %}">Set up Kindle </a>
                        </div>
                    {% endif %}
                </div>
            {% endif %}
            {% if readmill_epub_url %}
                <div id="readmill_div" class="yes_js">
                    <div class="send-to-readmill" data-download-url="{{ readmill_epub_url }}" data-buy-url="{{ base_url }}{% url work work.id %}"></div>
                </div>
            {% endif %}
            {% if not request.user.is_authenticated  %}
                 <div style="clear:left"> You'll need an unglue.it account to <i>Send to Kindle</i>.</div>
            {% endif %}
        </div>
    {% endif %}
    <div class="ebook_download_container">
    {% if unglued_ebooks or other_ebooks or acq %}
        {% if unglued_ebooks %}
            <h3>Download the unglued edition</h3>
            <div class="ebook_download">
                {% for ebook in unglued_ebooks %}
                    <a href="{% url download_ebook ebook.id %}">
                    <img src="{{ ebook.rights_badge }}" alt="{{ ebook.rights}}" title="{{ ebook.rights}}" /></a>
                    <a href="{% url download_ebook ebook.id %}"><img src="/static/images/{{ ebook.format }}32.png" height="32" alt="{{ ebook.format }}" title="{{ ebook.format }}" /></a>
                    <a href="{% url download_ebook ebook.id %}">{{ ebook.format }}</a> 
                    {% if not forloop.last %}<br /><br />{% endif %}
                {% endfor %}		
            </div>
        {% endif %}
        {% if other_ebooks %}
            {% if unglued_ebook %}
                <h4>Download other freely available editions</h4>
            {% else %}
                <h4>Download freely available editions</h4>
            {% endif %}
            <div class="ebook_download">
                {% for ebook in other_ebooks %}
                    <a href="{% url download_ebook ebook.id %}">
                    <img src="{{ ebook.rights_badge }}" alt="{{ ebook.rights}}" title="{{ ebook.rights}}" /></a>
                    <a href="{% url download_ebook ebook.id %}"><img src="/static/images/{{ ebook.format }}32.png" height="32" alt="{{ ebook.format }} at {{ebook.provider}}" title="{{ ebook.format }} at {{ebook.provider}}" /></a>
                    <a href="{% url download_ebook ebook.id %}">{{ ebook.format }} at {{ ebook.provider }}</a>
                    {% if not forloop.last %}<br /><br />{% endif %}
                {% endfor %}		
            </div>
        {% endif %}
        {% if acq %}
            <h3>Download your ebook{% if acq.lib_acq %}{% if acq.on_reserve %}, on reserve for you at{% else %}, on loan to you at{% endif %} {{ acq.lib_acq.user.library }}{% endif %}</h3>
            <div class="ebook_download">
                    <a href="{{ formats.epub }}"><img src="/static/images/epub32.png" height="32" alt="epub" title="epub" /></a>
                    <a href="{{ formats.epub }}">EPUB</a> (for iBooks, Nook, Kobo)
                    <br /><br />
                    <a href="{{ formats.mobi }}"><img src="/static/images/mobi32.png" height="32" alt="mobi" title="mobi" /></a>
                    <a href="{{ formats.mobi }}">MOBI</a> (for Kindle)
            </div>
        
        {% endif %}
    {% else %}
        <div class="border">
            <p id="content-block">There are no freely available downloads of <I>{{ work.title }}</I> right now.  {% if not work in request.user.wishlist.works.all %}Would you like there to be? <a class="add-wishlist"><span class="work_id" id="w{{ work.id }}">Add this book to your wishlist.</span></a>{% else %}Ask your friends to add it to their favorites!{% endif %}</p>
        
            <p>If you know of a Creative-Commons-licensed or US public domain edition of this book, you can add it through the <a href="{% url work work.id %}?tab=4">More... tab of the book page</a>.</p>
        </div>
    </div>
    {% endif %}
    <div class="clearfix"></div>
</div>
{% if unglued_ebooks or other_ebooks or acq %}
    <div class="border">
<h3>Need instructions?</h3>
    <div class="instructions">
        <div id="iOS_app_div"{% if iOS_app %} class="active"{% endif %}>
            <p>
                Looks like you're using an embedded browser inside an iOS app. (Maybe you followed a link in Twitter or Facebook?)
            </p>
            <p>
                {% if formats.epub or formats.mobi %}
                    To read this ebook you should open this page in safari. <img width="500" height="403" src="/static/images/open_safari.png" alt="how to open in safari" /><br clear="left" />
                {% endif %}
                {% if formats.pdf %}
                    You should also be able to use the  <a href="{{ formats.pdf }}">pdf</a> file.
                {% else %}{% if formats.html %}
                    You can read the <a href="{{ formats.html }}">HTML version</a> of this book right here in this browser.
                {% else %}{% if formats.text %}
                    You can read the <a href="{{ formats.text }}">text version</a> of this book right here in this browser.
                {% endif %}{% endif %}{% endif %}
            </p>
            <p class="other_instructions_paragraph">
                Not on iOS?  Try the instructions for <a class="android other_instructions">Android</a>, <a class="desktop other_instructions">desktop computers</a>, or <a class="ereader other_instructions">ereaders (Kindle, Nook, Kobo, etc.)</a>.
            </p>
        </div>
        
        <div id="ios_div"{% if iOS %}{% if not iOS_app %} class="active"{% endif %}{% endif %}>
            <h4>iOS devices</h4>
            {% if formats.epub %}
                <p>
                    You may already have an app which reads ebooks.  Download the <a href="{{ formats.epub }}">epub file</a> and see if you're offered an option for opening the file.  If so, you're done!  If not...
                </p>
                <p class="ebook_download logo"><img src="/static/images/ibooks_logo.jpeg" alt="iBooks Logo" />iBooks</p>
                <ul>
                <li><a href="http://itunes.apple.com/us/app/ibooks/id364709193?mt=8">Download the free iBooks app</a> from the App Store.</li>
                <li>Download the <a href="{{ formats.epub }}">epub file</a>.</li>
                <li>You will be given the option of opening the file in iBooks.</li>
                </ul>
                <p class="ebook_download logo"><img src="/static/images/readmill_logo.jpg" alt="iBooks Logo" />Readmill is another great option. </p>
                <ul>
                <li><a href="https://itunes.apple.com/us/app/readmill-book-reader-for-epub/id438032664?mt=8">Download the free Readmill app</a> from the App Store.</li>
                <li>Click the "Send to Readmill" button above.</li>
                <li>If you don't have a free Readmill account, you'll be given the option of creating one.</li>
                </ul>
            {% else %}{% if formats.pdf %}
                <p>
                    You may already have an app which reads ebooks.  Download the <a href="{{ formats.pdf }}">pdf file</a> and see if you're offered an option for opening the file.  If so, you're done!  If not...
                </p>
                <p class="ebook_download logo"><img src="/static/images/ibooks_logo.jpeg" alt="iBooks Logo" />iBooks</p>
                <ul>
                <li><a href="http://itunes.apple.com/us/app/ibooks/id364709193?mt=8">Download the free iBooks app</a> from the App Store.</li>
                <li>Download the <a href="{{ formats.pdf }}">pdf file</a>.</li>
                <li>You will be given the option of opening the file in iBooks.</li>
                </ul>
            {% else %}{% if formats.html %}
                <p>
                    Download the <a href="{{ formats.html }}">HTML version</a>.
                </p>
            {% else %}{% if formats.text %}
                <p>
                    Download the <a href="{{ formats.text }}">text version</a>.
                </p>
            {% else %}
                <p>
                    This ebook is only available in .mobi.  Your best bet is to install the free Amazon Kindle app from the Apple Store and then use the Send-to-Kindle option above.
                </p>
            {% endif %}{% endif %}{% endif %}{% endif %}
            <p class="other_instructions_paragraph">
                Not on iOS?  Try the instructions for <a class="android other_instructions">Android</a>, <a class="desktop other_instructions">desktop computers</a>, or <a class="ereader other_instructions">ereaders (Kindle, Nook, Kobo, etc.)</a>.
            </p>
        </div>
        
        <div id="android_div"{% if android %} class="active"{% endif %}>
            <h4>Android devices</h4>
            {% if formats.epub %}
                <p>
                    You may already have an app which reads ebooks.  Download the <a href="{{ formats.epub }}">epub file</a> and see if you're offered an option for opening the file.  If so, you're done!  If not...
                </p>
                <p class="ebook_download logo"><img src="/static/images/aldiko_logo.png" alt="Aldiko Logo" />Aldiko</p>
                
                <ul>
                <li><a href="http://www.aldiko.com/download.html">Download the free Aldiko app.</a></li>
                <li>Download the <a href="{{ formats.epub }}">epub file</a>.</li>
                <li>When the download is complete, tap it in your notifications menu.  It will be added to Aldiko, ready to read next time you open the app.</li>
                </ul>
            {% else %}{% if formats.pdf %}
                <p>
                    You may already have an app which reads ebooks.  Download the <a href="{{ formats.pdf }}">pdf file</a> and see if you're offered an option for opening the file.  If so, you're done!  If not...
                </p>
                <p class="ebook_download logo"><img src="/static/images/aldiko_logo.png" alt="Aldiko Logo" />Aldiko</p>
                
                <ul>
                <li><a href="http://www.aldiko.com/download.html">Download the free Aldiko app.</a></li>
                <li>Download the <a href="{{ formats.pdf }}">pdf file</a>.</li>
                <li>When the download is complete, tap it in your notifications menu.  It will be added to Aldiko, ready to read next time you open the app.</li>
                </ul>
            {% else %}{% if formats.html %}
                <p>
                    Download the <a href="{{ formats.html }}">HTML version</a>.
                </p>
            {% else %}{% if formats.text %}
                <p>
                    Download the <a href="{{ formats.text }}">text version</a>.
                </p>
            {% else %}
                <p>
                    This ebook is only available in .mobi.  Your best bet is to install the free Amazon Kindle app from Google Play and then use the Send-to-Kindle option above.
                </p>
            {% endif %}{% endif %}{% endif %}{% endif %}
            <p class="other_instructions_paragraph">
                Not on Android?  Try the instructions for <a class="ios other_instructions">iPhone/iPad</a>, <a class="desktop other_instructions">desktop computers</a>, or <a class="ereader other_instructions">ereaders (Kindle, Nook, Kobo, etc.)</a>.
            </p>
        </div>
        
        <div id="desktop_div"{% if desktop %} class="active"{% endif %}>
            <h4>Reading on a PC, Mac, or Linux</h4>
            {% if formats.pdf %}
                <p>
                    You probably already have an app which reads PDFs.  Download the <a href="{{ formats.pdf }}">pdf file</a> and open it.
                </p>
            {% else %}{% if formats.epub %}
                <p class="ebook_download logo"><img src="/static/images/calibre_logo.png" alt="Calibre Logo" />Calibre</p>
                <ul>
                <li><a href="http://calibre-ebook.com/download">Download the free Calibre app.</a></li>
                <li>Download the <a href="{{ formats.epub }}">epub file</a>.</li>
                <li>Open the file in Calibre.</li>
                </ul>
            {% else %}{% if formats.mobi %}
                <p class="ebook_download logo"><img src="/static/images/calibre_logo.png" alt="Calibre Logo" />Calibre</p>
                <ul>
                <li><a href="http://calibre-ebook.com/download">Download the free Calibre app.</a></li>
                {% if acq %}
                <li>Download the <a href="{{ formats.mobi }}">mobi file</a>.</li>
                {% else %}
                <li>Download the <a href="{{ formats.mobi }}">mobi file</a>.</li>
                {% endif %}
                <li>Open the file in Calibre.</li>
                </ul>
            {% else %}{% if formats.html %}
                <p>
                    You can read the <a href="{{ formats.html }}">HTML version</a> right here in your browser.
                </p>
            {% else %}
                <p>
                    You can read the <a href="{{ formats.text }}">text version</a> right here in your browser.
                </p>
            {% endif %}{% endif %}{% endif %}{% endif %}
            <p class="other_instructions_paragraph">
                Not on a desktop computer, or want to "side-load" ebooks onto a device or app?  Try the instructions for <a class="ios other_instructions">iPhone/iPad</a>, <a class="android other_instructions">Android</a>, or <a class="ereader other_instructions">ereaders (Kindle, Nook, Kobo, etc.)</a>.
            </p>
        </div>
        
        <div id="ereader_div"{% if desktop %} class="active"{% endif %}>
            <h4>Ereaders (Kindle, Nook, Kobo, etc.)</h4>
            
            {% if formats.mobi or formats.pdf or formats.epub %}
                <ul>
                <li>
                    {% if formats.mobi %}
                        <b>Kindle</b>: download the <a href="{{ formats.mobi }}">mobi file</a> to your computer, or use the <i>Send To Kindle</i> button above.
                    {% else %}{% if formats.pdf %}
                        <b>Kindle</b>: download the <a href="{{ formats.pdf }}">pdf file</a> to your computer, or use the <i>Send To Kindle</i> button above.
                    {% else %}
                        <b>Kindle</b>: We're sorry; we don't have a version suitable for Kindle.
                    {% endif %}{% endif %}
                    {% if formats.epub %}
                        <b>All other ereaders</b>: download the <a href="{{ formats.epub }}">epub file</a> to your computer.
                    {% else %}{% if formats.pdf %}
                        <b>All other ereaders</b>: download the <a href="{{ formats.pdf }}">pdf file</a> to your computer.
                    {% else %}
                        <b>All other ereaders</b>: We're sorry; we don't have a version suitable for your device.
                    {% endif %}{% endif %}
                </li>
                <li>Plug the ereader into your computer with a USB cable.</li>
                <li>Using the Finder (Mac) or Windows Explorer (Windows), drag and drop the ebook file into the Documents folder on your device.  (It may also be called My Documents or My Stuff, depending on your ereader.)</li>
                <li>Eject your device from the Finder or Explorer and disconnect the USB.</li>
                <li>You may need to reboot your device to see the new book.</li>
                </ul>
            {% else %}
                <p>
                    We're sorry; we don't have a file format suitable for ereaders.
                </p>
            {% endif %}
            <p class="other_instructions_paragraph">
                Not using an ereader?  Try the instructions for <a class="ios other_instructions">iPhone/iPad</a>, <a class="android other_instructions">Android</a>, or <a class="desktop other_instructions">desktop computers</a>.
            </p>
        </div>
    </div>
        
        {% comment %}
        If we're going to be providing mobi as the norm, let's not bother with these instructions.
        <div class="instructions">
            <h4>Converting epubs for Kindle</h4>
            <p>Kindles can read plain text, MOBI, PDF, and HTML files.  They cannot read epub books (the format unglued ebooks are released in).  However, you can convert epubs to mobi files using free software.</p>
            
            <ul>
            <li><a href="http://calibre-ebook.com/download">Download the free Calibre app</a> to a desktop or laptop computer.</li>
            <li>Download your book from this page onto the desktop or laptop.</li>
            <li>Open the ebook file in Calibre.</li>
            <li>Convert the epub to a mobi file: select the file; click on "convert books"; and set the output format to mobi.</li>
            <li>When the conversion is done, put the file on your device using the instructions for ereaders above.  If you've set up your Kindle email address at Amazon.com, you can also email it to yourself using the "Connect/share" button, without needing to plug your Kindle in.  Calibre will walk you through the process of setting up your Kindle email in Calibre.</li>
            </ul>
        </div>
        {% endcomment %}
        <br />
        <h4>Need more help?</h4>
        <p>Email us at <a href="mailto:support@gluejar.com?Subject=Ebook%20downloading%20help">support@gluejar.com</a>.</p>
        
        <div>
            <a href="http://www.defectivebydesign.org/drm-free"><img src="https://static.fsf.org/dbd/DRM-free/DRM-free150.png" alt="DefectiveByDesign.org" border="0" align="middle" /></a> All downloads from Unglue.it are DRM free. Hooray!
        </div>
    </div>
{% else %}
{% endif %}
</div>
</div>
{% endblock %}

{% endwith %}